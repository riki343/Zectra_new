{% extends '@Zectranet/layout.html.twig' %}

{% block title %}Index page{% endblock %}

{% block styles %}
	{{ parent() }}

{% endblock %}

{% block leftSidebar %}
	<div class="navbar-default sidebar" role="navigation">
		<div class="sidebar-nav navbar-collapse">
			<div id="quicksearch-block" ng-controller="SearchController">
				<ul class="nav">
					<li class="sidebar-search">
						<div class="input-group custom-search-form dropdown" >
							<input id="text-search" ng-model="searchInput"
								   class="form-control dropdown-toggle"
								   placeholder="Search..."
								   maxlength="50"
								   ng-change="InputChange()"
								   data-toggle="dropdown" type="search">
                                <span class="input-group-btn">
                                    <a ng-href="{{ path('zectranet_user_page',{ 'user_id' : app.user.id }) }}SearchPage/[[searchInput]]" ng-click="PreCheck();" class="btn btn-default"  >
                                        <i class="fa fa-search"></i>
                                    </a>
                                </span>
						</div>
					</li>
				</ul>

				<!-- BEGIN OF SITE TREE -->
				<ul class="nav" id="side-menu">

					<li>
						<a href="{{ path('zectranet_public_market') }}">
							<i class='fa fa-credit-card'></i>
							Public Market
						</a>
					</li>

					<li {% if office is defined %}
                            class="active"
                        {% elseif project is defined and project in app.user.projects %}
                            class="active"
                        {% elseif forum is defined and forum in app.user.connectedHFForums %}
                            class="active"
                        {% elseif forum is defined and forum in app.user.connectedQnAForums %}
                            class="active"
                        {% endif %}>
                        {% set homeOffice = app.user.homeOffice %}
                        {% set HOProjectsCount = app.user.projects | length + app.user.connectedHFForums | length
                                + app.user.connectedQnAForums | length %}
						<a href="{{ path('zectranet_show_office', {'office_id': app.user.homeOffice.id }) }}"
                           class="
                                {% if HOProjectsCount > 0 %}
                                    {{ 'non-collapsible-href' }}
                                {% else %}
                                    {{ 'non-collapsible-href-full' }}
                                {% endif %}">
							<i class='fa fa-home'></i>
							<span>Home Office</span>
						</a>
                        {% if HOProjectsCount > 0 %}
                            <a href="{{ path('zectranet_show_office', {'office_id': homeOffice.id }) }}" class="collapsible-href">
                                {% if office is defined %}
                                    <i class="fa fa-arrow-up fa-fw"></i>
                                {% elseif project is defined and project in app.user.projects %}
                                    <i class="fa fa-arrow-up fa-fw"></i>
                                {% elseif forum is defined and forum in app.user.connectedHFForums %}
                                    <i class="fa fa-arrow-up fa-fw"></i>
                                {% elseif forum is defined and forum in app.user.connectedQnAForums %}
                                    <i class="fa fa-arrow-up fa-fw"></i>
                                {% else %}
                                    <i class="fa fa-arrow-down fa-fw"></i>
                                {% endif %}
                            </a>
                        {% endif %}
                        <div class="clearfix"></div>
						<ul class="nav nav-second-level">
                            {% for project in app.user.projects if project.users | length == 1 %}
                                <li data-toggle="tooltip" data-placement="right" title="{{ project.name }}">
                                    <a href="{{ path('zectranet_show_project', {'project_id': project.id }) }}" style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                                        <i class="fa fa-briefcase fa-fw"></i>
                                       <span style="overflow: hidden; text-overflow: ellipsis;">{{ project.name }}</span>
                                    </a>
                                </li>
                            {% endfor %}

                            {% for project in app.user.connectedHFForums if project.users | length == 1 %}
                                <li data-toggle="tooltip" data-placement="right" title="{{ project.name }}">
                                    <a href="{{ path('zectranet_show_header_forum', {'project_id': project.id }) }}" style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                                        <i class="fa fa-briefcase fa-fw"></i>
                                       <span style="overflow: hidden; text-overflow: ellipsis;">{{ project.name }}</span>
                                    </a>
                                </li>
                            {% endfor %}

                            {% for project in app.user.connectedQnAForums if project.users | length == 1 %}
                                <li data-toggle="tooltip" data-placement="right" title="{{ project.name }}">
                                    <a href="{{ path('zectranet_show_QnA_forum', {'project_id': project.id }) }}" style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                                        <i class="fa fa-briefcase fa-fw"></i>
                                       <span style="overflow: hidden; text-overflow: ellipsis;">{{ project.name }}</span>
                                    </a>
                                </li>
                            {% endfor %}

                            <li>
                                {% set connectedProjectsCount = 0 %}
                                {% for project in app.user.projects if project.users | length > 1 %}
                                    {% set connectedProjectsCount = connectedProjectsCount + 1 %}
                                {% endfor %}
                                {% for project in app.user.connectedHFForums if project.users | length > 1 %}
                                    {% set connectedProjectsCount = connectedProjectsCount + 1 %}
                                {% endfor %}
                                {% for project in app.user.connectedQnAForums if project.users | length > 1 %}
                                    {% set connectedProjectsCount = connectedProjectsCount + 1 %}
                                {% endfor %}

                                <a href="#">
                                    <i class='fa fa-briefcase'></i>
                                    <span>Connected Projects</span>
                                    {% if connectedProjectsCount > 0 %}
                                        <span class="text-right pull-right">
                                            {% if office is defined %}
                                                <i class="fa fa-arrow-up fa-fw"></i>
                                            {% elseif project is defined and project in app.user.projects and project.users | length > 1 %}
                                                <i class="fa fa-arrow-up fa-fw"></i>
                                            {% elseif forum is defined and forum in app.user.connectedHFForums and forum.users | length > 1 %}
                                                <i class="fa fa-arrow-up fa-fw"></i>
                                            {% elseif forum is defined and forum in app.user.connectedQnAForums and forum.users | length > 1 %}
                                                <i class="fa fa-arrow-up fa-fw"></i>
                                            {% else %}
                                                <i class="fa fa-arrow-down fa-fw"></i>
                                            {% endif %}
                                        </span>
                                    {% endif %}
                                </a>
                                <ul class="nav nav-third-level">
                                    {% for project in app.user.projects if project.users | length > 1 %}
                                        <li data-toggle="tooltip" data-placement="right" title="{{ project.name }}">
                                            <a href="{{ path('zectranet_show_project', {'project_id': project.id }) }}" style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                                                <i class="fa fa-briefcase fa-fw"></i>
                                                <span style="overflow: hidden; text-overflow: ellipsis;">{{ project.name }}</span>
                                            </a>
                                        </li>
                                    {% endfor %}

                                    {% for project in app.user.connectedHFForums if project.users | length > 1 %}
                                        <li data-toggle="tooltip" data-placement="right" title="{{ project.name }}">
                                            <a href="{{ path('zectranet_show_header_forum', {'project_id': project.id }) }}" style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                                                <i class="fa fa-briefcase fa-fw"></i>
                                               <span style="overflow: hidden; text-overflow: ellipsis;">{{ project.name }}</span>
                                            </a>
                                        </li>
                                    {% endfor %}

                                    {% for project in app.user.connectedQnAForums if project.users | length > 1 %}
                                        <li data-toggle="tooltip" data-placement="right" title="{{ project.name }}">
                                            <a href="{{ path('zectranet_show_QnA_forum', {'project_id': project.id }) }}" style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                                                <i class="fa fa-briefcase fa-fw"></i>
                                               <span style="overflow: hidden; text-overflow: ellipsis;">{{ project.name }}</span>
                                            </a>
                                        </li>
                                    {% endfor %}
                                </ul>
                            </li>
                        </ul>
					</li>

                    {% for office in app.user.ownedOffices if office.id != app.user.homeOffice.id %}
                        <li data-toggle="tooltip" data-placement="right" title="{{ office.name }}">
                            <a href="{{ path('zectranet_show_office', {'office_id': office.id}) }}"
                               class="
                                    {% if office.projects | length > 0 %}
                                        {{ 'non-collapsible-href' }}
                                    {% else %}
                                        {{ 'non-collapsible-href-full' }}
                                    {% endif %}">
                                <i class='fa fa-home'></i>
                                <span>{{ office.name }}</span>
                            </a>
                            {% if office.projects | length > 0 %}
                                <a href="#" class="collapsible-href">
                                    <i class="fa fa-arrow-down fa-fw"></i>
                                </a>
                            {% endif %}
                            <div class="clearfix"></div>
                            <ul class="nav nav-second-level">
                                {% for project in office.projects %}
                                <li>
                                    <a href="{{ path('zectranet_show_project', {'project_id': project.id }) }}" style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                                       <span style="overflow: hidden; text-overflow: ellipsis;">{{ project.name }}</span>
                                    </a>
                                </li>
                                {% endfor %}
                            </ul>
                        </li>
                    {% endfor %}

                    {% for office in app.user.assignedOffices if office.id != app.user.homeOffice.id %}
                        <li data-toggle="tooltip" data-placement="right" title="{{ office.name }}">
                            <a href="{{ path('zectranet_show_office', {'office_id': office.id}) }}"
                               class="
                                    {% if office.projects | length > 0 %}
                                        {{ 'non-collapsible-href' }}
                                    {% else %}
                                        {{ 'non-collapsible-href-full' }}
                                    {% endif %}">
                                <i class='fa fa-home'></i>
                                <span>{{ office.name }}</span>
                            </a>
                            {% if office.projects | length > 0 %}
                                <a href="#" class="collapsible-href">
                                    <i class="fa fa-arrow-down fa-fw"></i>
                                </a>
                            {% endif %}
                            <div class="clearfix"></div>
                            <ul class="nav nav-second-level">
                                {% for project in office.projects %}
                                    <li>
                                        <a href="{{ path('zectranet_show_project', {'project_id': project.id }) }}" style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                                           <span style="overflow: hidden; text-overflow: ellipsis;">{{ project.name }}</span>
                                        </a>
                                    </li>
                                {% endfor %}
                            </ul>
                        </li>
                    {% endfor %}

                    {% if is_granted('ROLE_WEB_DEVELOPER') %}
                    <li>
                        <a href="{{ path('zectranet_get_error_logs') }}">
                            <i class='fa fa-close'></i>
                            Error Logs
                        </a>
                    </li>
                    {% endif %}

				</ul>
				<!-- END OF SITE TREE -->

			</div>
		</div>
	</div>

	{% block modals %}

	{% endblock %}
{% endblock %}


{% block body %}

	{% block breadcrumbs %}

	{% endblock %}

	{% block pageheader %}

	{% endblock %}

	{% block content %}

	{% endblock %}

{% endblock %}

{% block javascripts %}
	{{ parent() }}
	<script src="{{ asset('bundles/zectranet/js/custom/searchController.js') }}" type="text/javascript" ></script>
	<script src="{{ asset('bundles/zectranet/js/highlight.js') }}" type="text/javascript"></script>
	<script>
		// Variable for AngularJS
		TEMPPARAMS.USER_ID = {{ app.user.id }};
		JSON_URLS.deleteScrenshots  = "{{ path('zectranet_document_delete', { fileid : 0 }) }}";
		JSON_URLS.urlGetContactList  = "{{ path('zectranet_get_contact_list')}}";
		JSON_URLS.urlSendRequest  = "{{ path('zectranet_send_user_membership_request')}}";

        $(function () {
            $('[data-toggle="tooltip"]').tooltip()
        });
	</script>
{% endblock %}

